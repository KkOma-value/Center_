"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[366],{94149:function(b,f,r){r.d(f,{Z:function(){return L}});var v=r(1413),l=r(67294),Z={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832 464h-68V240c0-70.7-57.3-128-128-128H388c-70.7 0-128 57.3-128 128v224h-68c-17.7 0-32 14.3-32 32v384c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V496c0-17.7-14.3-32-32-32zM332 240c0-30.9 25.1-56 56-56h248c30.9 0 56 25.1 56 56v224H332V240zm460 600H232V536h560v304zM484 701v53c0 4.4 3.6 8 8 8h40c4.4 0 8-3.6 8-8v-53a48.01 48.01 0 10-56 0z"}}]},name:"lock",theme:"outlined"},i=Z,N=r(91146),g=function(m,P){return l.createElement(N.Z,(0,v.Z)((0,v.Z)({},m),{},{ref:P,icon:i}))},T=l.forwardRef(g),L=T},85371:function(b,f,r){r.r(f),r.d(f,{default:function(){return G}});var v=r(15009),l=r.n(v),Z=r(97857),i=r.n(Z),N=r(99289),g=r.n(N),T=r(5574),L=r.n(T),F=r(67294),m=r(76772),P=r(40056),c=r(8232),u=r(2453),O=r(26915),R=r(83622),M=r(87547),J=r(94149),E=r(66116),a={container:"container___REQAy",content:"content___IkUx1",formContainer:"formContainer___BmMXJ",headerTitle:"headerTitle___U7hig",tabs:"tabs___HS5a7",inputItem:"inputItem___GsBVG",captchaContainer:"captchaContainer___yhYeG",captchaInput:"captchaInput___DJJ3y",captchaButton:"captchaButton____rNFC",optionRow:"optionRow___V8f0D",autoLogin:"autoLogin___QlbJJ",optionLinks:"optionLinks___NjGUn",optionLink:"optionLink___pIbIL",submitButton:"submitButton___VupGo",otherLoginMethods:"otherLoginMethods___soS1E",otherLoginTitle:"otherLoginTitle___tX4QP",otherLoginIcons:"otherLoginIcons___bv757",icon:"icon___fqAhh"},n=r(85893),A=function(B){var j=B.content;return(0,n.jsx)(P.Z,{style:{marginBottom:24},message:j,type:"error",showIcon:!0})},D=function(){var B=(0,F.useState)({}),j=L()(B,2),z=j[0],h=j[1],U=(0,m.useModel)("@@initialState"),I=U.initialState,x=U.setInitialState,w=c.Z.useForm(),H=L()(w,1),$=H[0],Y=function(){var C=g()(l()().mark(function p(){var o,s;return l()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,I==null||(o=I.fetchUserInfo)===null||o===void 0?void 0:o.call(I);case 2:if(s=t.sent,!s){t.next=6;break}return x(function(d){return i()(i()({},d),{},{currentUser:s})}),t.abrupt("return",!0);case 6:return t.abrupt("return",!1);case 7:case"end":return t.stop()}},p)}));return function(){return C.apply(this,arguments)}}(),Q=function(){var C=g()(l()().mark(function p(o){var s,S,t,d,y;return l()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,console.log("Login request parameters:",{account:o.username,password:o.password}),e.next=4,fetch("/api/user/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({account:o.username,password:o.password})});case 4:if(s=e.sent,console.log("Login response status:",s.status,s.statusText),s.ok){e.next=14;break}return e.next=9,s.text();case 9:return S=e.sent,console.error("Error response content:",S),S.includes("<!DOCTYPE")?u.ZP.error("Request failed: Server returned HTML page instead of JSON data. API path might be wrong or backend service is not running properly"):u.ZP.error("Request failed: ".concat(s.status," ").concat(s.statusText)),h({status:"error"}),e.abrupt("return");case 14:return e.prev=14,e.next=17,s.text();case 17:if(d=e.sent,console.log("Raw response:",d),d.trim()!==""){e.next=23;break}return u.ZP.error("Server returned empty response"),h({status:"error"}),e.abrupt("return");case 23:t=JSON.parse(d),e.next=32;break;case 26:return e.prev=26,e.t0=e.catch(14),console.error("JSON parsing error:",e.t0),u.ZP.error("Response data format error: ".concat(e.t0.message)),h({status:"error"}),e.abrupt("return");case 32:if(console.log("Login response data:",t),!(t&&(t.id||t.userId))){e.next=44;break}u.ZP.success("Login successful!"),console.log("User role:",t.role),console.log("Complete user info:",t),y=i()(i()({},t),{},{name:t.username||t.name,avatar:t.avatarUrl||t.avatar}),localStorage.setItem("userInfo",JSON.stringify(y)),console.log("User info saved to localStorage:",y),x(function(k){return i()(i()({},k),{},{currentUser:y})}),console.log("Preparing to redirect to: /admin/user-management");try{window.location.href="/admin/user-management"}catch(k){console.error("Navigation error:",k),u.ZP.error("Page redirection failed, please refresh and try again")}return e.abrupt("return");case 44:h({status:"error"}),u.ZP.error("Incorrect username or password!"),e.next=53;break;case 48:e.prev=48,e.t1=e.catch(0),console.error("Login request exception:",e.t1),u.ZP.error("Login failed, please check your network connection: ".concat(e.t1.message)),h({status:"error"});case 53:case"end":return e.stop()}},p,null,[[0,48],[14,26]])}));return function(o){return C.apply(this,arguments)}}(),X=z.status;return(0,n.jsxs)("div",{className:a.container,children:[(0,n.jsx)("div",{className:a.content,children:(0,n.jsxs)("div",{className:a.formContainer,children:[(0,n.jsx)("h2",{className:a.headerTitle,children:"The kKoma"}),X==="error"&&(0,n.jsx)(A,{content:"\u8D26\u53F7\u6216\u5BC6\u7801\u9519\u8BEF"}),(0,n.jsxs)(c.Z,{form:$,onFinish:Q,children:[(0,n.jsx)(c.Z.Item,{name:"username",className:a.inputItem,rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u7528\u6237\u540D!"}],children:(0,n.jsx)(O.Z,{size:"large",prefix:(0,n.jsx)(M.Z,{}),placeholder:"\u7528\u6237\u540D"})}),(0,n.jsx)(c.Z.Item,{name:"password",className:a.inputItem,rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u5BC6\u7801\uFF01"}],children:(0,n.jsx)(O.Z.Password,{size:"large",prefix:(0,n.jsx)(J.Z,{}),placeholder:"\u5BC6\u7801"})}),(0,n.jsxs)("div",{className:a.optionRow,children:[(0,n.jsx)(c.Z.Item,{name:"autoLogin",valuePropName:"checked",noStyle:!0,children:(0,n.jsxs)("div",{className:a.autoLogin,children:[(0,n.jsx)("input",{type:"checkbox",id:"autoLogin"}),(0,n.jsx)("label",{htmlFor:"autoLogin",children:"\u81EA\u52A8\u767B\u5F55"})]})}),(0,n.jsxs)("div",{className:a.optionLinks,children:[(0,n.jsx)(m.Link,{to:"/user/register",className:a.optionLink,children:"\u6CE8\u518C\u8D26\u53F7"}),(0,n.jsx)(m.Link,{to:"/user/forgotPassword",className:a.optionLink,children:"\u5FD8\u8BB0\u5BC6\u7801"})]})]}),(0,n.jsx)(c.Z.Item,{children:(0,n.jsx)(R.ZP,{type:"primary",htmlType:"submit",className:a.submitButton,children:"\u767B\u5F55"})})]})]})}),(0,n.jsx)(E.Z,{})]})},G=D}}]);
